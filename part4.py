def stable_stock_matching(buyers_preferences, stocks_preferences):
    stable_buyers = {}
    stocks = list(stocks_preferences)

    while len(stocks) != 0:
        for i in stocks[:]:
            for j in buyers_preferences:
                if j not in stable_buyers.values():
                    stable_buyers[i] = j
                    stocks.remove(i)
                    break
                else:
                    stable_stocks = {value: key for key, value in stable_buyers.items()}
                    if buyers_preferences[j].index(i) < buyers_preferences[j].index(stable_stocks[j]):
                        stable_buyers[i] = j
                        stocks.remove(i)
                        stocks.append(stable_stocks[j])
                        break
    return stable_buyers


if __name__ == '__main__':
    buyers_preferences = {
        '1': ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '2': ['B', 'A', 'D', 'C', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '3': ['A', 'B', 'C', 'E', 'D', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '4': ['D', 'A', 'B', 'C', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '5': ['C', 'B', 'A', 'E', 'D', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '6': ['E', 'D', 'C', 'B', 'A', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '7': ['F', 'E', 'D', 'C', 'B', 'A', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '8': ['G', 'F', 'E', 'D', 'C', 'B', 'A', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '9': ['H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '10': ['I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '11': ['J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '12': ['K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '13': ['L', 'K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '14': ['M', 'L', 'K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '15': ['N', 'M', 'L', 'K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'O', 'P', 'Q', 'R', 'S', 'T'],
        '16': ['O', 'N', 'M', 'L', 'K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'P', 'Q', 'R', 'S', 'T'],
        '17': ['P', 'O', 'N', 'M', 'L', 'K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'Q', 'R', 'S', 'T'],
        '18': ['Q', 'P', 'O', 'N', 'M', 'L', 'K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'R', 'S', 'T'],
        '19': ['R', 'Q', 'P', 'O', 'N', 'M', 'L', 'K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'S', 'T'],
        '20': ['S', 'R', 'Q', 'P', 'O', 'N', 'M', 'L', 'K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'T']
    }

    stocks_preferences = {
        'A': ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'B': ['2', '1', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'C': ['1', '2', '3', '5', '4', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'D': ['4', '2', '1', '3', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'E': ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'F': ['7', '6', '5', '4', '3', '2', '1', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'G': ['8', '7', '6', '5', '4', '3', '2', '1', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'H': ['9', '8', '7', '6', '5', '4', '3', '2', '1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'I': ['10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'J': ['11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '12', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'K': ['12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '13', '14', '15', '16', '17', '18', '19',
              '20'],
        'L': ['13', '12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '14', '15', '16', '17', '18', '19',
              '20'],
        'M': ['14', '13', '12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '15', '16', '17', '18', '19',
              '20'],
        'N': ['15', '14', '13', '12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '16', '17', '18', '19',
              '20'],
        'O': ['16', '15', '14', '13', '12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '17', '18', '19',
              '20'],
        'P': ['17', '16', '15', '14', '13', '12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '18', '19',
              '20'],
        'Q': ['18', '17', '16', '15', '14', '13', '12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '19',
              '20'],
        'R': ['19', '18', '17', '16', '15', '14', '13', '12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1',
              '20'],
        'S': ['20', '19', '18', '17', '16', '15', '14', '13', '12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2',
              '1'],
        'T': ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
              '20']
    }

    print(stable_stock_matching(buyers_preferences, stocks_preferences))
